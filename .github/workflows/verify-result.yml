name: Verify Order Management System

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Build
      run: |
        chmod +x script/build.sh
        ./script/build.sh
    
    - name: Run Tests
      run: |
        chmod +x script/test.sh
        ./script/test.sh
    
    - name: Run Application
      run: |
        chmod +x script/run.sh
        ./script/run.sh
    
    - name: Verify result.txt exists
      run: |
        if [ ! -f result.txt ]; then
          echo "result.txt not found!"
          exit 1
        fi
        echo "result.txt found!"
        cat result.txt
    
    - name: Verify timestamps in result.txt
      run: |
        if ! grep -E "[0-9]{2}:[0-9]{2}:[0-9]{2}" result.txt; then
          echo "No timestamps found in result.txt!"
          exit 1
        fi
        echo "Timestamps verified!"